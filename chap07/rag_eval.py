"""
Module: RAG Evaluation
This module uses SentenceTransformer to compute cosine similarity between the
retrieved document and an AI-generated response, providing a faithfulness score.
"""

# -----------------------------------------------------------------------------
# Import Dependencies
# -----------------------------------------------------------------------------
from sentence_transformers import SentenceTransformer, util

# -----------------------------------------------------------------------------
# Initialize Sentence Transformer Model
# -----------------------------------------------------------------------------
# Load a pre-trained model for converting text to embeddings.
model = SentenceTransformer("all-MiniLM-L6-v2")


# -----------------------------------------------------------------------------
# Function: evaluate_rag_response
# -----------------------------------------------------------------------------
def evaluate_rag_response(retrieved_text, ai_response):
    """
    Evaluates the faithfulness of an AI-generated response against a retrieved document.

    This function encodes both the retrieved text and the AI response using a
    pre-trained sentence transformer, then computes the cosine similarity between
    their embeddings to determine how closely they align.

    Args:
        retrieved_text (str): The text retrieved from the document.
        ai_response (str): The response generated by the AI.

    Returns:
        float: The cosine similarity score indicating the level of faithfulness.
    """
    # Encode the retrieved text into a tensor embedding.
    retrieved_embedding = model.encode(retrieved_text, convert_to_tensor=True)
    # Encode the AI response into a tensor embedding.
    response_embedding = model.encode(ai_response, convert_to_tensor=True)

    # Calculate cosine similarity between the two embeddings.
    similarity_score = util.pytorch_cos_sim(
        retrieved_embedding, response_embedding
    ).item()

    return similarity_score


# -----------------------------------------------------------------------------
# Example Usage
# -----------------------------------------------------------------------------
if __name__ == "__main__":
    # Define a sample retrieved text and an AI-generated response.
    retrieved_text = "Albert Einstein developed the theory of relativity in 1905."
    ai_response = "The theory of relativity was formulated by Einstein in 1905."

    # Evaluate the response faithfulness.
    score = evaluate_rag_response(retrieved_text, ai_response)

    # Print the computed faithfulness score.
    print(f"Faithfulness Score: {score}")
